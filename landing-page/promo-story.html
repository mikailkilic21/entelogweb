<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EnteLog WhatsApp Story</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <style>
        body {
            font-family: 'Inter', sans-serif;
            overflow: hidden;
            background: #000;
        }

        .story-container {
            width: 100vw;
            height: 100vh;
            max-width: 450px;
            /* Mobile width constraint for desktop view */
            margin: 0 auto;
            position: relative;
            background: #0f172a;
            overflow: hidden;
        }

        .scene {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 2rem;
            opacity: 0;
            transition: opacity 0.5s;
            pointer-events: none;
        }

        .scene.active {
            opacity: 1;
            pointer-events: auto;
        }

        /* Progress Bar */
        .progress-bar {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
            z-index: 50;
        }

        .progress-segment {
            flex: 1;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            width: 0%;
            background: white;
            transition: width 0s linear;
            /* Default transition */
        }

        /* Custom Animations */
        @keyframes float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-20px);
            }
        }

        .animate-float {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes pulse-ring {
            0% {
                transform: scale(0.8);
                opacity: 0.5;
                box-shadow: 0 0 0 0 rgba(74, 222, 128, 0.7);
            }

            70% {
                transform: scale(1);
                opacity: 1;
                box-shadow: 0 0 0 20px rgba(74, 222, 128, 0);
            }

            100% {
                transform: scale(0.8);
                opacity: 0.5;
                box-shadow: 0 0 0 0 rgba(74, 222, 128, 0);
            }
        }

        .pulse-btn {
            animation: pulse-ring 2s infinite;
        }
    </style>
</head>

<body>

    <!-- Recording UI -->
    <div class="fixed top-4 right-4 z-[9999] flex flex-col items-end gap-2">
        <button id="recBtn" onclick="startRecording()"
            class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-full font-bold shadow-2xl flex items-center gap-2 transition-all hover:scale-105 ring-2 ring-white/20">
            <div class="w-3 h-3 bg-white rounded-full animate-pulse"></div>
            VÄ°DEOYU KAYDET
        </button>
        <p class="text-white/50 text-xs mr-2">Chrome'da "Bu Sekme (Current Tab)" seÃ§in</p>
    </div>

    <div class="story-container relative" id="captureTarget">
        <!-- Progress Bars -->
        <div class="progress-bar">
            <div class="progress-segment">
                <div class="progress-fill" id="p1"></div>
            </div>
            <div class="progress-segment">
                <div class="progress-fill" id="p2"></div>
            </div>
            <div class="progress-segment">
                <div class="progress-fill" id="p3"></div>
            </div>
            <div class="progress-segment">
                <div class="progress-fill" id="p4"></div>
            </div>
        </div>

        <!-- SCENE 1: PROBLEM (KAOS) -->
        <div class="scene active bg-red-900" id="scene1">
            <div
                class="absolute inset-0 opacity-20 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')]">
            </div>
            <i data-lucide="file-spreadsheet"
                class="w-32 h-32 text-red-400 mb-8 animate__animated animate__shakeX animate__infinite"></i>
            <h1 class="text-4xl font-black text-white mb-4 animate__animated animate__fadeInDown">EXCEL'DE<br>KAYBOLMA!
            </h1>
            <p class="text-xl text-red-200 animate__animated animate__fadeInUp">Stok hatalarÄ± ve kayÄ±p faturalar kaderin
                deÄŸil.</p>
        </div>

        <!-- SCENE 2: SOLUTION (ENTELOG) -->
        <div class="scene bg-slate-900" id="scene2">
            <div class="absolute inset-0 bg-gradient-to-br from-blue-900 to-slate-900"></div>

            <div class="bg-white p-4 rounded-2xl shadow-2xl mb-8 animate__animated animate__zoomIn">
                <img src="logo.png" class="h-12 w-auto" onerror="this.style.display='none'">
                <h2 class="text-3xl font-black text-slate-900 mt-2">ENTELOG</h2>
            </div>

            <h1 class="text-4xl font-bold text-white mb-6 animate__animated animate__fadeInUp">Ä°ÅžÄ°NÄ°N YENÄ°<br><span
                    class="text-blue-400">DÄ°JÄ°TAL BEYNÄ°</span></h1>

            <div class="grid grid-cols-2 gap-4 w-full px-4">
                <div class="bg-white/10 p-4 rounded-xl backdrop-blur animate__animated animate__fadeInLeft"
                    style="animation-delay: 0.2s">
                    <i data-lucide="smartphone" class="w-8 h-8 text-blue-400 mx-auto mb-2"></i>
                    <span class="text-white font-bold">Mobil</span>
                </div>
                <div class="bg-white/10 p-4 rounded-xl backdrop-blur animate__animated animate__fadeInRight"
                    style="animation-delay: 0.4s">
                    <i data-lucide="monitor" class="w-8 h-8 text-blue-400 mx-auto mb-2"></i>
                    <span class="text-white font-bold">Web</span>
                </div>
            </div>
        </div>

        <!-- SCENE 3: SYNCHRONIZATION -->
        <div class="scene bg-indigo-900" id="scene3">
            <div class="relative w-full h-64 flex items-center justify-center">
                <i data-lucide="refresh-cw" class="w-48 h-48 text-indigo-400 absolute animate-spin opacity-20"></i>
                <div class="z-10 text-center">
                    <i data-lucide="zap" class="w-24 h-24 text-yellow-400 fill-yellow-400 animate-bounce"></i>
                </div>
            </div>
            <h1 class="text-4xl font-black text-white mb-4 animate__animated animate__fadeIn">TAM<br>SENKRONÄ°ZE</h1>
            <p class="text-lg text-indigo-200">Sahada sat, ofiste gÃ¶r.<br>AnlÄ±k stok ve cari takibi.</p>
        </div>

        <!-- SCENE 4: CTA (FINAL) -->
        <div class="scene bg-emerald-900" id="scene4">
            <div
                class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cube-coat.png')] opacity-10">
            </div>

            <h2 class="text-2xl text-emerald-200 mb-2 uppercase tracking-widest animate__animated animate__fadeInDown">
                Hemen BaÅŸla</h2>
            <h1 class="text-5xl font-black text-white mb-8 animate__animated animate__zoomIn">TASARRUFA<br>GEÃ‡!</h1>

            <div
                class="bg-white text-emerald-900 px-8 py-4 rounded-full font-black text-xl shadow-xl hover:scale-105 transition-transform flex items-center justify-center gap-2 animate__animated animate__rubberBand animate__delay-1s">
                www.entelog.com.tr
                <i data-lucide="arrow-right-circle" class="w-6 h-6"></i>
            </div>

            <div class="mt-12 opacity-70 animate__animated animate__fadeInUp animate__delay-2s">
                <p class="text-white text-sm">YukarÄ± KaydÄ±r â–²</p>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();

        const scenes = ['scene1', 'scene2', 'scene3', 'scene4'];
        const durations = [3000, 3000, 3000, 5000]; // Duration for each scene in ms
        let currentScene = 0;
        let isRecording = false;
        let mediaRecorder;
        let recordedChunks = [];
        let stream;

        // Reset all scenes to init state
        function resetAnimation() {
            document.querySelectorAll('.scene').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.progress-fill').forEach(el => {
                el.style.width = '0%';
                el.style.transition = 'none';
            });
            clearTimeout(window.animTimeout);
        }

        function playScene(index) {
            // Safety Check
            if (index >= scenes.length) {
                if (isRecording) {
                    stopRecording();
                } else {
                    playScene(0); // Loop
                }
                return;
            }

            // Hide all scenes
            document.querySelectorAll('.scene').forEach(el => el.classList.remove('active'));

            // Set previous bars to full (instant)
            for (let i = 0; i < index; i++) {
                const p = document.getElementById(`p${i + 1}`);
                p.style.transition = 'none';
                p.style.width = '100%';
            }

            // Show current scene
            const sceneId = scenes[index];
            document.getElementById(sceneId).classList.add('active');

            // Animate Current Progress Bar
            const bar = document.getElementById(`p${index + 1}`);
            // Force reflow
            void bar.offsetWidth;

            bar.style.transition = `width ${durations[index]}ms linear`;
            bar.style.width = '100%';

            // Schedule next scene
            window.animTimeout = setTimeout(() => {
                playScene(index + 1);
            }, durations[index]);
        }

        // --- Recording Logic ---
        async function startRecording() {
            const btn = document.getElementById('recBtn');

            try {
                // Ask user to select screen
                stream = await navigator.mediaDevices.getDisplayMedia({
                    video: {
                        displaySurface: "browser", // Prefer current tab
                        frameRate: 30
                    },
                    audio: false,
                    selfBrowserSurface: "include" // Try to include current tab without popup if possible
                });

                // Reset Animation & UI
                resetAnimation();
                isRecording = true;
                btn.innerHTML = 'ðŸ”´ KAYIT SÃœRÃœYOR... (DokunmayÄ±n)';
                btn.className = 'bg-slate-900 text-white px-6 py-3 rounded-full font-bold shadow-2xl flex items-center gap-2 border border-red-500 animate-pulse';

                // Initialize Recorder
                mediaRecorder = new MediaRecorder(stream, { mimeType: 'video/webm; codecs=vp9' });
                recordedChunks = [];

                mediaRecorder.ondataavailable = function (e) {
                    if (e.data.size > 0) recordedChunks.push(e.data);
                };

                mediaRecorder.onstop = function () {
                    const blob = new Blob(recordedChunks, { type: 'video/webm' });
                    const url = URL.createObjectURL(blob);

                    // Trigger Download
                    const a = document.createElement('a');
                    a.style.display = 'none';
                    a.href = url;
                    a.download = `EnteLog_Story_${new Date().toISOString().slice(0, 10)}.webm`;
                    document.body.appendChild(a);
                    a.click();

                    // Cleanup
                    window.URL.revokeObjectURL(url);
                    stream.getTracks().forEach(track => track.stop());

                    // Reset UI
                    btn.innerHTML = 'âœ… Ä°NDÄ°RÄ°LDÄ°! Tekrar Kaydet?';
                    btn.className = 'bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-full font-bold shadow-2xl flex items-center gap-2 transition-all';
                    isRecording = false;

                    // Restart Loop
                    resetAnimation();
                    playScene(0);
                };

                // Start recording
                mediaRecorder.start();

                // Wait 1 sec for recording to stabilize then start animation
                setTimeout(() => {
                    playScene(0);
                }, 1000);

            } catch (err) {
                console.error("Error: " + err);
                alert("KayÄ±t baÅŸlatÄ±lamadÄ±. LÃ¼tfen tekrar deneyin ve 'Bu Sekme'yi seÃ§tiÄŸinizden emin olun.");
                isRecording = false;
                btn.innerHTML = 'VÄ°DEOYU KAYDET';
                playScene(0);
            }
        }

        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
            }
        }

        // Auto-play on load (preview mode)
        window.onload = () => playScene(0);
    </script>
</body>

</html>